#!/usr/bin/ruby --disable-gems

if ARGV.empty?
  warn "command required"
  exit 1
end

command = ARGV.shift

if command != "new" && command != "tags"
  warn "unrecognized command: #{command}"
  exit 1
end

notes_dir = File.expand_path(ENV.fetch("NOTES_DIR", "~/.notes"))

if command == "tags"
  exec "ls", notes_dir
end

if command == "new"
  if ARGV.empty?
    warn "tag required"
    exit 1
  end

  tag = ARGV.shift

  require "date"
  require "fileutils"

  tag_dir = File.join(notes_dir, tag)
  timestamp = Date.today.strftime("%Y-%m-%d")
  note_path = File.join(tag_dir, "#{timestamp}.md")

  FileUtils.mkdir_p(tag_dir)

  exec ENV["EDITOR"], note_path
end
